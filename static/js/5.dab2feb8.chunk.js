webpackJsonp([5],{731:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function l(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),o=n.n(s),i=n(8),c=n(32),u=(n.n(c),function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}()),d=(n(265),n(786)),m=n(42),f=n(32),h=f.getCurrentHost,p=f.startPlayer,E=n(17),y=(Object(c.getShareHost)(),function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={resourceList:[],download:null,loadingMsg:"Downloading(\u4e0b\u8f7d\u4e2d) ...",showqr:!1,qrName:""},n.state.shareMsg="",n.share=new d(n.state),n.tags="",n.resName="",n.resId="",n.infoInterval=null,n.torrentList=[],n}return l(t,e),u(t,[{key:"componentDidMount",value:function(){var e=window.location.hash,t=null,n=null;if(e){var a=e.indexOf("#",1);if(a>0){t=e.substr(a+1,40);var r=e.indexOf("#",a+40);r>0&&(n=e.substr(r+1)),t&&40==t.length&&(n?(n=c.Url.decode(n),this.setState({download:n})):this.setState({download:t}),this.startDownload(t))}}this.share.init(this.onTorrentDone.bind(this),this.onTorrentStart.bind(this))}},{key:"startDownload",value:function(e){var t=Object(c.getShareHost)()+"/btb?action=p2pTransfer&resId="+e;m.concat({url:t,json:!0},function(t,n,a){if(t)return void this.setState({shareMsg:"err.\u51fa\u9519\u4e86"});if(a.ok){var r="1234567890"+E(15).toString("hex");p(r,{id:e})}else this.setState({shareMsg:"not free resource.(\u4e0d\u662f\u514d\u8d39\u8d44\u6e90)"})}.bind(this))}},{key:"prettyBytes",value:function(e){var t,n,a=e<0,r=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];return a&&(e=-e),e<1?(a?"-":"")+e+" B":(t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),r.length-1),e=Number((e/Math.pow(1e3,t)).toFixed(2)),n=r[t],(a?"-":"")+e+" "+n)}},{key:"updateTorrentStatus",value:function(){var e=this;this.torrentList.map(function(t){var n=document.querySelector("#pid"+t.infoHash),a=document.querySelector("#sid"+t.infoHash);n&&(n.innerHTML=t.numPeers),a&&(a.innerHTML=e.prettyBytes(t.uploadSpeed)+"/s")})}},{key:"onTorrentStart",value:function(){this.setState({shareMsg:"working...\u5904\u7406\u4e2d..."})}},{key:"onTorrentDone",value:function(e){if(e){e.infoHash,e.magnetURI,e.torrentFileBlobURL,e.name;this.resId=e.infoHash,this.resName=e.name;var t=this.state.resourceList;t.push({id:this.resId,name:this.resName}),this.setState({resourceList:t}),e.key=e.infoHash,this.torrentList.unshift(e)}this.infoInterval||(this.infoInterval=setInterval(this.updateTorrentStatus.bind(this),3e3)),this.setState({shareMsg:""})}},{key:"renderAddFile",value:function(){return o.a.createElement(i.Q,null,o.a.createElement(i.k,{xs:"12"},o.a.createElement(i.r,null,o.a.createElement(i.g,null,o.a.createElement(i.j,null,o.a.createElement("i",{className:"icon-share"},"P2P File Transfer(\u70b9\u5bf9\u70b9\u6587\u4ef6\u4f20\u8f93)"),o.a.createElement("div",{className:"card-header-actions"},o.a.createElement(i.e,{color:"link",className:"card-header-action btn-setting"},o.a.createElement("i",{className:"icon-settings"})))),o.a.createElement(i.l,{isOpen:!0,id:"collapseExample"},o.a.createElement(i.h,null,o.a.createElement("div",null,o.a.createElement("p",null,"Select file to transfer(\u9009\u62e9\u8981\u4f20\u8f93\u7684\u6587\u4ef6,\u76f4\u63a5\u53d1\u9001\u7ed9\u597d\u53cb\uff0c\u652f\u6301\u624b\u673a\u4e0e\u7535\u8111\u4e4b\u95f4\u9ad8\u901f\u6587\u4ef6\u4f20\u8f93).")),o.a.createElement(i.s,null,o.a.createElement("div",{className:"controls"},o.a.createElement(i.u,{className:"input-prepend"},o.a.createElement(i.v,{addonType:"prepend"},o.a.createElement(i.w,null,"Resource(\u8d44\u6e90):")),o.a.createElement("input",{name:"upload",type:"file"})))),o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement(i.a,{color:"danger"},o.a.createElement("small",null,this.state.shareMsg))))))))))}},{key:"showBarcode",value:function(e,t){this.setState({showqr:!0,qrName:t});var n=h()+"/#/fly#"+e+"#"+t;setTimeout(function(){Object(c.showQRDialog)(n)},1500)}},{key:"copyAddress",value:function(e){var t=document.querySelector("#url_"+e);t.focus(),t.select();var n=document.execCommand("copy"),a=document.querySelector("#msg_"+e);a.innerHTML=n?"OK.\u590d\u5236\u6210\u529f":"ERR.\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236"}},{key:"renderResourceItems",value:function(){var e=this;return this.state.resourceList.map(function(t){var n="pid"+t.id,a="sid"+t.id;return o.a.createElement(i.z,{key:t.id,action:!0},o.a.createElement(i.A,null," ",o.a.createElement("i",{className:"fa fa-barcode",onClick:function(n){return e.showBarcode(t.id,t.name)}}),o.a.createElement("span",null," ",t.name," : \u8bf7\u5c06\u4e0b\u9762\u5730\u5740\u53d1\u7ed9\u597d\u53cb\u4e0b\u8f7d"),o.a.createElement(i.e,{color:"ghost-success",onClick:function(n){return e.copyAddress(t.id)}},o.a.createElement("i",{className:"fa fa-copy fa-lg"}),"\xa0Copy Address(\u590d\u5236\u5730\u5740)"),o.a.createElement("span",{className:"alert-primary",id:"msg_"+t.id})),o.a.createElement(i.A,null,o.a.createElement("input",{readOnly:!0,style:{width:"100%"},id:"url_"+t.id,value:h()+"/#/fly#"+t.id+"#"+t.name})),o.a.createElement(i.B,null,o.a.createElement("code",null," ",o.a.createElement("span",{id:n})," peers(\u8282\u70b9)"),". \u2197",o.a.createElement("code",null,o.a.createElement("span",{id:a}),"(\u4e0a\u4f20\u901f\u5ea6)")))})}},{key:"toggle",value:function(){this.setState({showqr:!this.state.showqr})}},{key:"renderShareList",value:function(){return o.a.createElement(i.Q,null,o.a.createElement(i.k,{sm:"12",xl:"6"},o.a.createElement(i.g,null,o.a.createElement(i.j,null,o.a.createElement("i",{className:"fa fa-align-justify"}),o.a.createElement("strong",null,"Transfer List(\u4f20\u8f93\u5217\u8868)"),o.a.createElement(i.a,{color:"danger"},o.a.createElement("small",null,"\u8d44\u6e90\u4e0d\u4f1a\u4e0a\u4f20\u7ed9\u4efb\u4f55\u670d\u52a1\u5668\uff0c\u70b9\u5bf9\u70b9\u76f4\u63a5\u4ece\u672c\u5730\u4e0b\u8f7d\u3002Please keep this page open.\u8bf7\u4e0d\u8981\u5237\u65b0\u6216\u5173\u95ed\u6b64\u9875\u9762\uff0c\u4fdd\u6301\u6b64\u9875\u9762\u6253\u5f00\u72b6\u6001\u4e0b\uff0c\u6587\u4ef6\u4f20\u8f93\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002\u9875\u9762\u5f02\u5e38\u60c5\u51b5\u53ef\u4ee5\u91cd\u65b0\u9009\u62e9\u6587\u4ef6\u7ee7\u7eed\u4f20\u8f93\u3002"))),o.a.createElement(i.h,null,o.a.createElement(i.y,null,this.renderResourceItems()),o.a.createElement(i.C,{isOpen:this.state.showqr,className:this.props.className},o.a.createElement(i.F,{toggle:this.toggle.bind(this)},this.state.qrName),o.a.createElement(i.D,null,o.a.createElement("div",{id:"qrcode"})))))))}},{key:"renderPlayer",value:function(){return this.state.download?o.a.createElement("div",{id:"playdiv"},o.a.createElement(i.g,null,o.a.createElement(i.j,null,this.state.download,o.a.createElement(i.b,{color:"success",className:"float-right"},this.state.loadingMsg)),o.a.createElement(i.h,null,o.a.createElement("div",{id:"status"},o.a.createElement("div",null,o.a.createElement("span",{className:"show-leech"}," from "),o.a.createElement("code",{id:"numPeers"},"0 peers"),".",o.a.createElement("code",{id:"downloadSpeed"},"0 b/s ")," / \u2197",o.a.createElement("code",{id:"uploadSpeed"},"0 b/s - "),o.a.createElement("code",{id:"downloaded"})," of",o.a.createElement("code",{id:"total"})," \u2014",o.a.createElement("span",{id:"remaining"}))),o.a.createElement("div",{id:"player",style:{width:"100%"}})))):null}},{key:"render",value:function(){return o.a.createElement("div",{className:"animated fadeIn"},this.renderPlayer(),this.renderAddFile(),this.renderShareList())}}]),t}(s.Component));t.default=y},786:function(e,t,n){function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=n(266),s=(n(265),function(){function e(t){a(this,e),this.state=t;var n={iceServers:[{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun.btbresource.com:3478"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]};this.client=new l({tracker:{rtcConfig:n}}),this.torrentCallback=null,this.onStartCallback=null}return r(e,[{key:"init",value:function(e,t,n){this.torrentCallback=e,this.onStartCallback=t;var a=n;a||(a=document.querySelector("input[name=upload]")),a&&this.uploadElement(a,function(e,t){if(e)return e;t=t.map(function(e){return e.file}),this.onFiles(t)}.bind(this))}},{key:"isTorrentFile",value:function(e){return-1!==e.name.indexOf(".torrent")}},{key:"isNotTorrentFile",value:function(e){return!this.isTorrentFile(e)}},{key:"onSeedTorrent",value:function(e){e.on("warning",function(e){}),e.on("error",function(e){}),this.torrentCallback(e)}},{key:"seed",value:function(e){0!==e.length&&(this.onStartCallback(),this.client.seed(e,this.onSeedTorrent.bind(this)))}},{key:"onFiles",value:function(e){console.log("got files:"),e.forEach(function(e){}),this.seed(e)}},{key:"uploadElement",value:function(e,t,n){"function"===typeof t&&(n=t,t={}),"string"===typeof t&&(t={type:t}),e.addEventListener("change",function(a){function r(n){var a=e.files[n];"text"===t.type?l.readAsText(a):"url"===t.type?l.readAsDataURL(a):l.readAsArrayBuffer(a)}if(0===e.files.length)return n(null,[]);var l=new FileReader,s=0,o=[];l.addEventListener("load",function(t){o.push({file:e.files[s],target:t.target}),s++,s===e.files.length?n(null,o):r(s)}),r(s)})}}]),e}());e.exports=s}});
//# sourceMappingURL=5.dab2feb8.chunk.js.map
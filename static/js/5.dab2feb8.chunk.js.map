{"version":3,"sources":["../static/js/5.dab2feb8.chunk.js","views/ggv/FileTransfer/FileTransfer.js","views/ggv/js/share.js"],"names":["webpackJsonp","731","module","__webpack_exports__","__webpack_require__","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","defineProperty","__WEBPACK_IMPORTED_MODULE_0_react__","__WEBPACK_IMPORTED_MODULE_0_react___default","n","__WEBPACK_IMPORTED_MODULE_1_reactstrap__","__WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js__","_createClass","defineProperties","target","props","i","length","descriptor","key","protoProps","staticProps","ShareManager","get","_require","getCurrentHost","startPlayer","randombytes","FileTransfer","_Component","this","_this","getPrototypeOf","state","resourceList","download","loadingMsg","showqr","qrName","shareMsg","share","tags","resName","resId","infoInterval","torrentList","hash","window","location","query","name","idx","indexOf","substr","idx2","decode","setState","startDownload","init","onTorrentDone","bind","onTorrentStart","url","concat","json","err","r","data","ok","pid","toString","id","num","exponent","unit","neg","units","Math","min","floor","log","Number","pow","toFixed","_this2","map","torrent","peersSpan","document","querySelector","infoHash","speedSpan","innerHTML","numPeers","prettyBytes","uploadSpeed","magnetURI","torrentFileBlobURL","rlist","push","unshift","setInterval","updateTorrentStatus","a","createElement","xs","className","color","isOpen","addonType","type","setTimeout","resid","addr","focus","select","successful","execCommand","msg","_this3","res","sid","action","onClick","e","showBarcode","copyAddress","readOnly","style","width","sm","xl","renderResourceItems","toggle","renderPlayer","renderAddFile","renderShareList","786","exports","WebTorrent","rtcConfig","iceServers","urls","client","tracker","torrentCallback","onStartCallback","uploadInput","up","uploadElement","files","file","onFiles","isTorrentFile","on","warn","seed","onSeedTorrent","console","forEach","elem","opts","cb","addEventListener","ev","read","index","reader","readAsText","readAsDataURL","readAsArrayBuffer","FileReader","results"],"mappings":"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","file":"static/js/5.dab2feb8.chunk.js","sourcesContent":["webpackJsonp([5],{\n\n/***/ 731:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_react__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_reactstrap__ = __webpack_require__(8);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js__ = __webpack_require__(32);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js__);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var moment=__webpack_require__(265);var ShareManager=__webpack_require__(786);var get=__webpack_require__(42);var _require=__webpack_require__(32),getCurrentHost=_require.getCurrentHost,startPlayer=_require.startPlayer;var randombytes=__webpack_require__(17);var host=Object(__WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js__[\"getShareHost\"])();var FileTransfer=function(_Component){_inherits(FileTransfer,_Component);function FileTransfer(props){_classCallCheck(this,FileTransfer);var _this=_possibleConstructorReturn(this,(FileTransfer.__proto__||Object.getPrototypeOf(FileTransfer)).call(this,props));_this.state={resourceList:[],download:null,loadingMsg:'Downloading(下载中) ...',showqr:false,qrName:''};_this.state.shareMsg='';_this.share=new ShareManager(_this.state);/*\r\n        this.userSec = window.sessionStorage.getItem(\"userSec\");\r\n        if (!this.userSec) {\r\n          this.userSec = window.localStorage.getItem(\"userSec\");\r\n        }\r\n        */_this.tags='';_this.resName='';_this.resId='';_this.infoInterval=null;_this.torrentList=[];return _this;}_createClass(FileTransfer,[{key:'componentDidMount',value:function componentDidMount(){var hash=window.location.hash;var query=null;var name=null;if(hash){var idx=hash.indexOf(\"#\",1);if(idx>0){//\nquery=hash.substr(idx+1,40);var idx2=hash.indexOf(\"#\",idx+40);{if(idx2>0){name=hash.substr(idx2+1);}}// console.log('query=' + query + \" name=\" + name);\nif(query&&query.length==40){if(name){name=__WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js__[\"Url\"].decode(name);this.setState({download:name});}else{this.setState({download:query});}this.startDownload(query);}}}this.share.init(this.onTorrentDone.bind(this),this.onTorrentStart.bind(this));}},{key:'startDownload',value:function startDownload(resId){var url=Object(__WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js__[\"getShareHost\"])()+\"/btb?action=p2pTransfer&resId=\"+resId;get.concat({url:url,json:true},function(err,r,data){if(err){//console.log(err);\nthis.setState({shareMsg:'err.出错了'});return;}if(data.ok){//ok to play\nvar pid='1234567890'+randombytes(15).toString('hex');startPlayer(pid,{id:resId});}else{this.setState({shareMsg:'not free resource.(不是免费资源)'});}}.bind(this));}},{key:'prettyBytes',value:function prettyBytes(num){var exponent,unit,neg=num<0,units=['B','kB','MB','GB','TB','PB','EB','ZB','YB'];if(neg)num=-num;if(num<1)return(neg?'-':'')+num+' B';exponent=Math.min(Math.floor(Math.log(num)/Math.log(1000)),units.length-1);num=Number((num/Math.pow(1000,exponent)).toFixed(2));unit=units[exponent];return(neg?'-':'')+num+' '+unit;}},{key:'updateTorrentStatus',value:function updateTorrentStatus(){var _this2=this;//console.log('size ' + this.torrentList.length)\nthis.torrentList.map(function(torrent){//uploadSpeed peers\nvar peersSpan=document.querySelector('#pid'+torrent.infoHash);var speedSpan=document.querySelector('#sid'+torrent.infoHash);if(peersSpan)peersSpan.innerHTML=torrent.numPeers;if(speedSpan)speedSpan.innerHTML=_this2.prettyBytes(torrent.uploadSpeed)+'/s';});}},{key:'onTorrentStart',value:function onTorrentStart(){this.setState({shareMsg:'working...处理中...'});}},{key:'onTorrentDone',value:function onTorrentDone(torrent){if(torrent){var info='Torrent info hash: '+torrent.infoHash+'magnetURI='+torrent.magnetURI+' torrentFileBlobURL=\"'+torrent.torrentFileBlobURL+'name='+torrent.name;//console.log(info);\nthis.resId=torrent.infoHash;this.resName=torrent.name;var rlist=this.state.resourceList;rlist.push({id:this.resId,name:this.resName});this.setState({resourceList:rlist});torrent.key=torrent.infoHash;//tags is not set yet\n//torrent.tags = this.tags;\nthis.torrentList.unshift(torrent);}if(!this.infoInterval){this.infoInterval=setInterval(this.updateTorrentStatus.bind(this),3000);}this.setState({shareMsg:''});}},{key:'renderAddFile',value:function renderAddFile(){return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"Q\" /* Row */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"k\" /* Col */],{xs:'12'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"r\" /* Fade */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"g\" /* Card */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"j\" /* CardHeader */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('i',{className:'icon-share'},'P2P File Transfer(\\u70B9\\u5BF9\\u70B9\\u6587\\u4EF6\\u4F20\\u8F93)'),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{className:'card-header-actions'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"e\" /* Button */],{color:'link',className:'card-header-action btn-setting'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('i',{className:'icon-settings'})))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"l\" /* Collapse */],{isOpen:true,id:'collapseExample'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"h\" /* CardBody */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('p',null,'Select file to transfer(\\u9009\\u62E9\\u8981\\u4F20\\u8F93\\u7684\\u6587\\u4EF6,\\u76F4\\u63A5\\u53D1\\u9001\\u7ED9\\u597D\\u53CB\\uFF0C\\u652F\\u6301\\u624B\\u673A\\u4E0E\\u7535\\u8111\\u4E4B\\u95F4\\u9AD8\\u901F\\u6587\\u4EF6\\u4F20\\u8F93).')),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"s\" /* FormGroup */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{className:'controls'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"u\" /* InputGroup */],{className:'input-prepend'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"v\" /* InputGroupAddon */],{addonType:'prepend'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"w\" /* InputGroupText */],null,'Resource(\\u8D44\\u6E90):')),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('input',{name:'upload',type:'file'})))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('p',null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"a\" /* Alert */],{color:'danger'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('small',null,this.state.shareMsg))))))))));}},{key:'showBarcode',value:function showBarcode(resId,resName){this.setState({showqr:true,qrName:resName});var url=getCurrentHost()+\"/#/fly#\"+resId+'#'+resName;setTimeout(function(){Object(__WEBPACK_IMPORTED_MODULE_2__js_gegeUtil_js__[\"showQRDialog\"])(url);},1500);}},{key:'copyAddress',value:function copyAddress(resid){var addr=document.querySelector('#url_'+resid);addr.focus();addr.select();var successful=document.execCommand('copy');var msg=document.querySelector('#msg_'+resid);if(successful){msg.innerHTML='OK.复制成功';}else{msg.innerHTML='ERR.复制失败，请手动复制';}}},{key:'renderResourceItems',value:function renderResourceItems(){var _this3=this;var items=this.state.resourceList.map(function(res){var pid='pid'+res.id;var sid='sid'+res.id;return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"z\" /* ListGroupItem */],{key:res.id,action:true},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"A\" /* ListGroupItemHeading */],null,' ',__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('i',{className:'fa fa-barcode',onClick:function onClick(e){return _this3.showBarcode(res.id,res.name);}}),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('span',null,' ',res.name,' : \\u8BF7\\u5C06\\u4E0B\\u9762\\u5730\\u5740\\u53D1\\u7ED9\\u597D\\u53CB\\u4E0B\\u8F7D'),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"e\" /* Button */],{color:'ghost-success',onClick:function onClick(e){return _this3.copyAddress(res.id);}},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('i',{className:'fa fa-copy fa-lg'}),'\\xA0Copy Address(\\u590D\\u5236\\u5730\\u5740)'),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('span',{className:'alert-primary',id:'msg_'+res.id})),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"A\" /* ListGroupItemHeading */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('input',{readOnly:true,style:{width:'100%'},id:'url_'+res.id,value:getCurrentHost()+\"/#/fly#\"+res.id+'#'+res.name})),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"B\" /* ListGroupItemText */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('code',null,' ',__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('span',{id:pid}),' peers(\\u8282\\u70B9)'),'. \\u2197',__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('code',null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('span',{id:sid}),'(\\u4E0A\\u4F20\\u901F\\u5EA6)')));});return items;}},{key:'toggle',value:function toggle(){this.setState({showqr:!this.state.showqr});}},{key:'renderShareList',value:function renderShareList(){return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"Q\" /* Row */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"k\" /* Col */],{sm:'12',xl:'6'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"g\" /* Card */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"j\" /* CardHeader */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('i',{className:'fa fa-align-justify'}),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('strong',null,'Transfer List(\\u4F20\\u8F93\\u5217\\u8868)'),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"a\" /* Alert */],{color:'danger'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('small',null,'\\u8D44\\u6E90\\u4E0D\\u4F1A\\u4E0A\\u4F20\\u7ED9\\u4EFB\\u4F55\\u670D\\u52A1\\u5668\\uFF0C\\u70B9\\u5BF9\\u70B9\\u76F4\\u63A5\\u4ECE\\u672C\\u5730\\u4E0B\\u8F7D\\u3002Please keep this page open.\\u8BF7\\u4E0D\\u8981\\u5237\\u65B0\\u6216\\u5173\\u95ED\\u6B64\\u9875\\u9762\\uFF0C\\u4FDD\\u6301\\u6B64\\u9875\\u9762\\u6253\\u5F00\\u72B6\\u6001\\u4E0B\\uFF0C\\u6587\\u4EF6\\u4F20\\u8F93\\u624D\\u80FD\\u6B63\\u5E38\\u5DE5\\u4F5C\\u3002\\u9875\\u9762\\u5F02\\u5E38\\u60C5\\u51B5\\u53EF\\u4EE5\\u91CD\\u65B0\\u9009\\u62E9\\u6587\\u4EF6\\u7EE7\\u7EED\\u4F20\\u8F93\\u3002'))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"h\" /* CardBody */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"y\" /* ListGroup */],null,this.renderResourceItems()),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"C\" /* Modal */],{isOpen:this.state.showqr,className:this.props.className},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"F\" /* ModalHeader */],{toggle:this.toggle.bind(this)},this.state.qrName),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"D\" /* ModalBody */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{id:'qrcode'})))))));}},{key:'renderPlayer',value:function renderPlayer(){if(!this.state.download)return null;return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{id:'playdiv'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"g\" /* Card */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"j\" /* CardHeader */],null,this.state.download,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"b\" /* Badge */],{color:'success',className:'float-right'},this.state.loadingMsg)),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_reactstrap__[\"h\" /* CardBody */],null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{id:'status'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('span',{className:'show-leech'},' from '),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('code',{id:'numPeers'},'0 peers'),'.',__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('code',{id:'downloadSpeed'},'0 b/s '),' / \\u2197',__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('code',{id:'uploadSpeed'},'0 b/s - '),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('code',{id:'downloaded'}),' of',__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('code',{id:'total'}),' \\u2014',__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('span',{id:'remaining'}))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{id:'player',style:{width:'100%'}}))));}},{key:'render',value:function render(){return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{className:'animated fadeIn'},this.renderPlayer(),this.renderAddFile(),this.renderShareList());}}]);return FileTransfer;}(__WEBPACK_IMPORTED_MODULE_0_react__[\"Component\"]);/* harmony default export */ __webpack_exports__[\"default\"] = (FileTransfer);\n\n/***/ }),\n\n/***/ 786:\n/***/ (function(module, exports, __webpack_require__) {\n\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var WebTorrent=__webpack_require__(266);var moment=__webpack_require__(265);var ShareManager=function(){function ShareManager(state){_classCallCheck(this,ShareManager);this.state=state;var rtcConfig={\"iceServers\":[{\"urls\":\"stun:stun2.l.google.com:19302\"},{\"urls\":\"stun:stun3.l.google.com:19302\"},{\"urls\":\"stun:stun.btbresource.com:3478\"},{\"urls\":\"stun:global.stun.twilio.com:3478?transport=udp\"}]};this.client=new WebTorrent({tracker:{rtcConfig:rtcConfig}});this.torrentCallback=null;this.onStartCallback=null;}_createClass(ShareManager,[{key:'init',value:function init(torrentCallback,onStartCallback,uploadInput){this.torrentCallback=torrentCallback;this.onStartCallback=onStartCallback;var up=uploadInput;if(!up)up=document.querySelector('input[name=upload]');if(up){this.uploadElement(up,function(err,files){if(err)return err;files=files.map(function(file){return file.file;});this.onFiles(files);}.bind(this));}}},{key:'isTorrentFile',value:function isTorrentFile(file){//var extname = path.extname(file.name).toLowerCase()\nreturn file.name.indexOf('.torrent')!==-1;}},{key:'isNotTorrentFile',value:function isNotTorrentFile(file){return!this.isTorrentFile(file);}},{key:'onSeedTorrent',value:function onSeedTorrent(torrent){torrent.on('warning',function(warn){// console.log(warn);\n});torrent.on('error',function(err){//console.log(err);\n});this.torrentCallback(torrent);}},{key:'seed',value:function seed(files){if(files.length===0)return;//console.log('Seeding ' + files.length + ' files')\nthis.onStartCallback();// Seed from WebTorrent\nthis.client.seed(files,this.onSeedTorrent.bind(this));}//\n},{key:'onFiles',value:function onFiles(files){console.log('got files:');files.forEach(function(file){// console.log(' - %s (%s bytes)', file.name, file.size)\n});// .torrent file = start downloading the torrent\n//files.filter(isTorrentFile).forEach(downloadTorrentFile)\n// everything else = seed these files\nthis.seed(files);}},{key:'uploadElement',value:function uploadElement(elem,opts,cb){if(typeof opts==='function'){cb=opts;opts={};}if(typeof opts==='string')opts={type:opts};elem.addEventListener('change',function(ev){if(elem.files.length===0)return cb(null,[]);var reader=new FileReader();var index=0;var results=[];reader.addEventListener('load',function(e){results.push({file:elem.files[index],target:e.target});index++;if(index===elem.files.length)cb(null,results);else read(index);});read(index);function read(index){var file=elem.files[index];if(opts.type==='text'){reader.readAsText(file);}else if(opts.type==='url'){reader.readAsDataURL(file);}else reader.readAsArrayBuffer(file);}});}}]);return ShareManager;}();module.exports=ShareManager;\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/5.dab2feb8.chunk.js","import React, { Component } from 'react';\r\nimport { Badge, Card, CardBody, CardHeader, Col, Row } from 'reactstrap';\r\nimport { Button, InputGroup, InputGroupAddon, InputGroupText, Alert } from 'reactstrap';\r\nimport { FormGroup, Fade, Collapse, ListGroup, ListGroupItem, ListGroupItemHeading, ListGroupItemText } from 'reactstrap'\r\nimport { Modal, ModalBody, ModalHeader } from 'reactstrap'\r\nimport { getShareHost, Url, showQRDialog } from '../js/gegeUtil.js'\r\n\r\nconst moment = require('moment')\r\nconst ShareManager = require('../js/share')\r\nconst get = require('simple-get')\r\nconst { getCurrentHost, startPlayer } = require('../js/gegeUtil')\r\nvar randombytes = require('randombytes')\r\nlet host = getShareHost();\r\n\r\nclass FileTransfer extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { resourceList: [], download: null, loadingMsg: 'Downloading(下载中) ...', showqr: false, qrName: '' }\r\n        this.state.shareMsg = '';\r\n        this.share = new ShareManager(this.state);\r\n        /*\r\n        this.userSec = window.sessionStorage.getItem(\"userSec\");\r\n        if (!this.userSec) {\r\n          this.userSec = window.localStorage.getItem(\"userSec\");\r\n        }\r\n        */\r\n        this.tags = ''\r\n        this.resName = ''\r\n        this.resId = ''\r\n        this.infoInterval = null\r\n        this.torrentList = []\r\n    }\r\n\r\n    componentDidMount() {\r\n\r\n        let hash = window.location.hash;\r\n        let query = null;\r\n        let name = null;\r\n        if (hash) {\r\n            let idx = hash.indexOf(\"#\", 1);\r\n            if (idx > 0) {\r\n                //\r\n                query = hash.substr(idx + 1, 40);\r\n                let idx2 = hash.indexOf(\"#\", idx + 40); {\r\n                    if (idx2 > 0) {\r\n                        name = hash.substr(idx2 + 1);\r\n                    }\r\n                }\r\n                // console.log('query=' + query + \" name=\" + name);\r\n                if (query && query.length == 40) {\r\n                    if (name) {\r\n                        name = Url.decode(name);\r\n                        this.setState({ download: name })\r\n                    } else {\r\n                        this.setState({ download: query })\r\n                    }\r\n                    this.startDownload(query);\r\n                }\r\n            }\r\n        }\r\n        this.share.init(this.onTorrentDone.bind(this), this.onTorrentStart.bind(this))\r\n    }\r\n\r\n    startDownload(resId) {\r\n        var url =getShareHost() + \"/btb?action=p2pTransfer&resId=\" + resId;\r\n\r\n        get.concat({ url: url, json: true }, (function (err, r, data) {\r\n            if (err) {\r\n                //console.log(err);\r\n                this.setState({ shareMsg: 'err.出错了' });\r\n                return;\r\n            }\r\n            if (data.ok) {\r\n                //ok to play\r\n                let pid = '1234567890' + randombytes(15).toString('hex')\r\n                startPlayer(pid, { id: resId });\r\n\r\n            } else {\r\n                this.setState({ shareMsg: 'not free resource.(不是免费资源)' });\r\n            }\r\n        }).bind(this))\r\n    }\r\n\r\n    prettyBytes(num) {\r\n        var exponent, unit, neg = num < 0, units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n        if (neg) num = -num\r\n        if (num < 1) return (neg ? '-' : '') + num + ' B'\r\n        exponent = Math.min(Math.floor(Math.log(num) / Math.log(1000)), units.length - 1)\r\n        num = Number((num / Math.pow(1000, exponent)).toFixed(2))\r\n        unit = units[exponent]\r\n        return (neg ? '-' : '') + num + ' ' + unit\r\n    }\r\n\r\n    updateTorrentStatus() {\r\n        //console.log('size ' + this.torrentList.length)\r\n        this.torrentList.map((torrent) => {\r\n            //uploadSpeed peers\r\n            let peersSpan = document.querySelector('#pid' + torrent.infoHash);\r\n            let speedSpan = document.querySelector('#sid' + torrent.infoHash);\r\n            if (peersSpan)\r\n                peersSpan.innerHTML = torrent.numPeers;\r\n            if (speedSpan)\r\n                speedSpan.innerHTML = this.prettyBytes(torrent.uploadSpeed) + '/s';\r\n        })\r\n    }\r\n\r\n    onTorrentStart() {\r\n        this.setState({ shareMsg: 'working...处理中...' })\r\n    }\r\n\r\n    onTorrentDone(torrent) {\r\n        if (torrent) {\r\n            var info = 'Torrent info hash: ' + torrent.infoHash +\r\n                'magnetURI=' + torrent.magnetURI +\r\n                ' torrentFileBlobURL=\"' + torrent.torrentFileBlobURL + 'name=' + torrent.name;\r\n            //console.log(info);\r\n            this.resId = torrent.infoHash\r\n            this.resName = torrent.name;\r\n            var rlist = this.state.resourceList;\r\n            rlist.push({ id: this.resId, name: this.resName })\r\n            this.setState({ resourceList: rlist })\r\n            torrent.key = torrent.infoHash;\r\n            //tags is not set yet\r\n            //torrent.tags = this.tags;\r\n            this.torrentList.unshift(torrent)\r\n        }\r\n        if (!this.infoInterval) {\r\n            this.infoInterval = setInterval(this.updateTorrentStatus.bind(this), 3000);\r\n        }\r\n        this.setState({ shareMsg: '' })\r\n    }\r\n\r\n\r\n    renderAddFile() {\r\n        return (<Row>\r\n            <Col xs=\"12\">\r\n                <Fade>\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <i className=\"icon-share\">P2P File Transfer(点对点文件传输)</i>\r\n                            <div className=\"card-header-actions\">\r\n                                <Button color=\"link\" className=\"card-header-action btn-setting\"><i className=\"icon-settings\"></i></Button>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <Collapse isOpen={true} id=\"collapseExample\">\r\n                            <CardBody>\r\n                                <div>\r\n                                    <p>Select file to transfer(选择要传输的文件,直接发送给好友，支持手机与电脑之间高速文件传输).</p>\r\n                                </div>\r\n                                <FormGroup>\r\n                                    <div className=\"controls\">\r\n                                        <InputGroup className=\"input-prepend\">\r\n                                            <InputGroupAddon addonType=\"prepend\">\r\n                                                <InputGroupText>Resource(资源):</InputGroupText>\r\n                                            </InputGroupAddon>\r\n                                            <input name=\"upload\" type=\"file\"></input>\r\n                                        </InputGroup>\r\n                                    </div>\r\n                                </FormGroup>\r\n                                <div>\r\n                                    <p><Alert color=\"danger\"><small>{this.state.shareMsg}</small></Alert></p>\r\n                                </div>\r\n                            </CardBody>\r\n                        </Collapse>\r\n                    </Card>\r\n                </Fade>\r\n            </Col>\r\n        </Row>)\r\n    }\r\n\r\n    showBarcode(resId, resName) {\r\n        this.setState({ showqr: true, qrName: resName });\r\n        var url = getCurrentHost() + \"/#/fly#\" + resId + '#' + resName;\r\n        setTimeout(() => {\r\n            showQRDialog(url);\r\n        }, 1500);\r\n    }\r\n\r\n    copyAddress(resid) {\r\n        let addr = document.querySelector('#url_' + resid);\r\n        addr.focus()\r\n        addr.select()\r\n        var successful = document.execCommand('copy');\r\n        let msg = document.querySelector('#msg_' + resid);\r\n        if (successful) {\r\n            msg.innerHTML = 'OK.复制成功'\r\n        } else {\r\n            msg.innerHTML = 'ERR.复制失败，请手动复制'\r\n        }\r\n    }\r\n\r\n    renderResourceItems() {\r\n        let items = this.state.resourceList.map((res) => {\r\n            let pid = 'pid' + res.id;\r\n            let sid = 'sid' + res.id;\r\n            return (<ListGroupItem key={res.id} action>\r\n                <ListGroupItemHeading> <i className=\"fa fa-barcode\" onClick={(e) => this.showBarcode(res.id, res.name)}></i><span> {res.name} : 请将下面地址发给好友下载</span>\r\n                    <Button color=\"ghost-success\" onClick={(e) => this.copyAddress(res.id)}>\r\n                        <i className=\"fa fa-copy fa-lg\"></i>&nbsp;Copy Address(复制地址)\r\n        </Button>\r\n                    <span className='alert-primary' id={'msg_' + res.id}></span>\r\n                </ListGroupItemHeading>\r\n                <ListGroupItemHeading><input readOnly style={{ width: '100%' }} id={'url_' + res.id} value={getCurrentHost() + \"/#/fly#\" + res.id + '#' + res.name}></input></ListGroupItemHeading>\r\n                <ListGroupItemText>\r\n                    <code> <span id={pid}></span> peers(节点)</code>. &#x2197;<code><span id={sid}></span>(上传速度)</code>\r\n                </ListGroupItemText>\r\n            </ListGroupItem>)\r\n        })\r\n        return items;\r\n    }\r\n\r\n    toggle() {\r\n        this.setState({ showqr: !this.state.showqr })\r\n    }\r\n\r\n    renderShareList() {\r\n        return (<Row>\r\n            <Col sm=\"12\" xl=\"6\">\r\n                <Card>\r\n                    <CardHeader>\r\n                        <i className=\"fa fa-align-justify\"></i><strong>Transfer List(传输列表)</strong>\r\n                        <Alert color=\"danger\"><small>资源不会上传给任何服务器，点对点直接从本地下载。Please keep this page open.请不要刷新或关闭此页面，保持此页面打开状态下，文件传输才能正常工作。页面异常情况可以重新选择文件继续传输。</small></Alert>\r\n                    </CardHeader>\r\n                    <CardBody>\r\n                        <ListGroup>\r\n                            {this.renderResourceItems()}\r\n                        </ListGroup>\r\n                        <Modal isOpen={this.state.showqr} className={this.props.className}>\r\n                            <ModalHeader toggle={this.toggle.bind(this)}>{this.state.qrName}</ModalHeader>\r\n                            <ModalBody>\r\n                                <div id=\"qrcode\"></div>\r\n                            </ModalBody>\r\n                        </Modal>\r\n                    </CardBody>\r\n                </Card>\r\n            </Col>\r\n        </Row>)\r\n    }\r\n\r\n    renderPlayer() {\r\n        if (!this.state.download)\r\n            return null;\r\n        return (\r\n            <div id=\"playdiv\">\r\n                <Card>\r\n                    <CardHeader>\r\n                        {this.state.download}\r\n                        <Badge color=\"success\" className=\"float-right\">{this.state.loadingMsg}</Badge>\r\n                    </CardHeader>\r\n                    <CardBody>\r\n                        <div id=\"status\">\r\n                            <div>\r\n                                <span className=\"show-leech\"> from </span>\r\n                                <code id=\"numPeers\">0 peers</code>.\r\n                            <code id=\"downloadSpeed\">0 b/s </code> / &#x2197;\r\n                            <code id=\"uploadSpeed\">0 b/s - </code>\r\n                                <code id=\"downloaded\"></code> of\r\n                            <code id=\"total\"></code> —\r\n                            <span id=\"remaining\"></span>\r\n                            </div>\r\n                        </div>\r\n                        <div id=\"player\" style={{ width: '100%' }}>\r\n                        </div>\r\n                    </CardBody>\r\n                </Card>\r\n\r\n            </div>\r\n        )\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"animated fadeIn\">\r\n                {this.renderPlayer()}\r\n                {this.renderAddFile()}\r\n                {this.renderShareList()}\r\n\r\n            </div>\r\n\r\n        );\r\n    }\r\n}\r\n\r\nexport default FileTransfer;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/views/ggv/FileTransfer/FileTransfer.js","const WebTorrent = require('gege-torrent')\r\nconst moment = require('moment');\r\n\r\n\r\nclass ShareManager {\r\n\r\n    constructor(state) {\r\n        this.state = state;\r\n        let rtcConfig = {\r\n            \"iceServers\": [\r\n                { \"urls\": \"stun:stun2.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun3.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun.btbresource.com:3478\" },\r\n                {\r\n                    \"urls\": \"stun:global.stun.twilio.com:3478?transport=udp\"\r\n                }\r\n            ]\r\n        };\r\n        this.client = new WebTorrent({\r\n            tracker: {\r\n                rtcConfig: rtcConfig\r\n            }\r\n        })\r\n        this.torrentCallback = null\r\n        this.onStartCallback = null\r\n    }\r\n\r\n    init(torrentCallback, onStartCallback, uploadInput) {\r\n        this.torrentCallback = torrentCallback;\r\n        this.onStartCallback = onStartCallback;\r\n        var up = uploadInput;\r\n        if (!up)\r\n            up = document.querySelector('input[name=upload]')\r\n        if (up) {\r\n            this.uploadElement(up, (function (err, files) {\r\n                if (err) return err;\r\n                files = files.map(function (file) { return file.file })\r\n                this.onFiles(files)\r\n            }).bind(this))\r\n        }\r\n    }\r\n\r\n    isTorrentFile(file) {\r\n        //var extname = path.extname(file.name).toLowerCase()\r\n        return file.name.indexOf('.torrent') !== -1;\r\n    }\r\n\r\n    isNotTorrentFile(file) {\r\n        return !this.isTorrentFile(file)\r\n    }\r\n\r\n    onSeedTorrent(torrent) {\r\n        torrent.on('warning', function (warn) {\r\n           // console.log(warn);\r\n        })\r\n        torrent.on('error', function (err) {\r\n            //console.log(err);\r\n        })\r\n        this.torrentCallback(torrent);\r\n    }\r\n\r\n    seed(files) {\r\n        if (files.length === 0) return\r\n        //console.log('Seeding ' + files.length + ' files')\r\n        this.onStartCallback()\r\n        // Seed from WebTorrent\r\n        this.client.seed(files, this.onSeedTorrent.bind(this));\r\n    }\r\n    //\r\n    onFiles(files) {\r\n        console.log('got files:')\r\n        files.forEach(function (file) {\r\n           // console.log(' - %s (%s bytes)', file.name, file.size)\r\n        })\r\n\r\n        // .torrent file = start downloading the torrent\r\n        //files.filter(isTorrentFile).forEach(downloadTorrentFile)\r\n\r\n        // everything else = seed these files\r\n        this.seed(files)\r\n    }\r\n\r\n    uploadElement(elem, opts, cb) {\r\n        if (typeof opts === 'function') {\r\n            cb = opts;\r\n            opts = {};\r\n        }\r\n        if (typeof opts === 'string') opts = { type: opts };\r\n\r\n        elem.addEventListener('change', function (ev) {\r\n            if (elem.files.length === 0) return cb(null, []);\r\n\r\n            var reader = new FileReader;\r\n            var index = 0;\r\n            var results = [];\r\n\r\n            reader.addEventListener('load', function (e) {\r\n                results.push({\r\n                    file: elem.files[index],\r\n                    target: e.target\r\n                });\r\n                index++;\r\n                if (index === elem.files.length) cb(null, results)\r\n                else read(index)\r\n            });\r\n            read(index);\r\n\r\n            function read(index) {\r\n                var file = elem.files[index];\r\n                if (opts.type === 'text') {\r\n                    reader.readAsText(file);\r\n                }\r\n                else if (opts.type === 'url') {\r\n                    reader.readAsDataURL(file);\r\n                }\r\n                else reader.readAsArrayBuffer(file);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = ShareManager;\n\n\n// WEBPACK FOOTER //\n// ./src/views/ggv/js/share.js"],"sourceRoot":""}